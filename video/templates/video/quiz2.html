{% extends "video/base.html" %}
{% block content %}


{% load i18n %}
{% load static %}

<style>


    .teacher {
        float: right !important;
    }
    .successbtn{
        background-color: teal !important;
        color: white;
    }

    .skipp{
        background-color: rgb(107, 11, 107) !important;
        color: white !important;
    }
    .skipp-dark{
        background-color: rgb(240, 183, 240) !important;
        color: rgb(67, 2, 70) !important;
    }
    
    .sweet-alert-dark{
            background-color: rgb(208, 222, 231) !important;
        }


    .successbtn-dark{
        background-color: rgb(178, 226, 226) !important;
        color: rgb(8, 68, 35);
    }
    
    .answeeer{
        color: rgb(50, 103, 218) !important;
    }

    .answeeer-dark{
        color: rgb(223, 231, 250) !important;
    }

    .wrrong{
        background-color: rgb(206, 35, 35);
        border: 1px solid rgb(153, 19, 19);
        color: #fff;
    }
    .wrrong-dark{
        background-color: rgb(241, 212, 216);
        border: 1px solid rgb(189, 137, 140) !important;
        color: rgb(68, 4, 9) !important;
    }

    .skiip{
        background-color: rgb(35, 103, 206);
        border: 1px solid rgb(24, 85, 177);
        color: #fff;
    }
    .skiip-dark{
        background-color: rgb(207, 218, 235);
        border: 1px solid rgb(146, 168, 201) !important;
        color: rgb(4, 43, 68) !important;
    }
    .coreect{
        background-color: rgb(49, 143, 61);
        border: 1px solid rgb(41, 124, 52);
        color: #fff !important;
    }
    .coreect-dark{
        background-color: rgb(202, 243, 208);
        border: 1px solid rgb(152, 219, 161) !important;
        color: rgb(16, 85, 53) !important;
    }

    .bluesky {
        background: #61e076bf !important;
    }
    .btn-accentt{
        background-color: red !important;
        color: #fff !important;
    }
    .btn-accentt-dark{
        background-color: rgb(221, 171, 171) !important;
        color: rgb(71, 12, 12) !important;
    }

    .message {
        max-width: 300px;
        clear: both;
        text-decoration: none;
        list-style-type: none;
        margin: 5px 5px 0px 5px;
        float: left;
        margin-right: 20px;
        padding: 0px 0px;
        min-width: 160px;
        min-height: 10px;
        max-width: 350px;
        border-radius: 5px;
        line-height: 1.4;
        word-wrap: break-word;
        color: #444444;
        text-align: left;
    }
</style>

<style>


.sidebar{
    background-color: #ebedf0 !important;
    border-left: 1px solid #ebedf0 !important;
}

.sidebar-dark{
    background-color: #22252c !important;
    border-left: 1px solid #323741 !important;
}


.mdk-drawer-layout__content .app-messages__container-dark{
    background-color: #4c525e !important;
}

.blllu{
    color: rgb(11, 111, 241) !important;
} 

.blllu-dark{
    color: rgb(177, 197, 223) !important;
    margin-right: 8px !important;
}


.card-footer{
    background-color: rgb(255, 255, 255) !important;
    border-bottom: 0.5px solid rgb(211, 228, 236)!important;
}


.bllu{
    color: rgb(57, 137, 241) !important;
} 
.bllu-dark{

    color: rgb(177, 200, 230) !important;
}
.card-footer-dark{
    background-color: rgb(26, 28, 34) !important;
    border: 1px solid rgb(9, 10, 12) !important;
}

.btn-light{
    background-color: #3a76d1 !important;
    color: rgb(199, 199, 199) !important;
    
    border: 1px solid  #2d62b3 !important;
    box-shadow: none !important;
}


.btn-light-dark{
    background-color: #323741 !important;
    color: rgb(199, 199, 199) !important;
    
    border: 1px solid  #21242b !important;
    box-shadow: none !important;
}


.brd{
    border: 1px solid rgb(201, 201, 201);
    color: #fff;
}

.brd-dark{
    border: 1px solid rgb(98, 112, 121);
    color: rgb(202, 202, 202);
}


.avatar-offline:after,
.avatar-offline:before,
.avatar-online:after,
.avatar-online:before {
    display: none !important;
}


.sidebar-dark{
    background-color: #22252c !important;
    border-left: 1px solid #323741 !important;
}


.sidebar-dark .divee{
    background-color: #22252c !important;
    border-left: 1px solid #1d1f22 !important;
}


.mediabout{
    color: rgb(21, 43, 71) !important;
}
  
.mediabout-dark{
   color: rgb(219, 219, 219) !important;
}


.ptt{
    padding-top: 80px !important;
}
.btn-primary{
    background-color: rgb(33, 150, 243)!important;
    color: rgb(254, 254, 255);
    float: right !important;
    margin-left: 15px !important;
    border: 1px solid rgb(20, 71, 167) !important;
}

.btn-primary-dark{
    background-color: #323741 !important;
    color: rgb(199, 199, 199) !important;
    float: right !important;
    border: 1px solid  #21242b !important;
    margin-left: 15px !important;
    box-shadow: none !important;
}


.message__body{
    text-align: right !important;
    width: 250px !important;
}

.card-dark{
        background-color: rgb(195, 211, 226) !important;
        border: 1px solid rgb(196, 201, 211) !important;
}


.progress .bg-primary{
background-color: rgb(45, 95, 189) !important;
border-radius: 0 !important;
}

.progress .bg-primary-dark{
background-color: rgb(142, 165, 209) !important;
border-radius: 0 !important;
}
.message__body .card{
        background-color: rgb(235, 237, 240) !important;
        border: 1px solid rgb(215, 220, 228) !important;
    }

.message{
    background-color: transparent !important;
}

.message-dark{
    background-color: transparent !important;
}

.teachername{
    color: rgb(1, 36, 59) !important;
    font-weight:700 !important;
    text-decoration: none !important;
    border: 0 !important;
}

.teachermsg{
    color: rgb(0, 77, 128);
}

strong{
    border-bottom: none !important;
}

 
.navbar-dark{
    background-color: #22252c !important;
    border-bottom: 1px solid #1b1d22!important;
}

.bgg-primary{
    background-color: rgb(63, 0, 82) !important;
}
.bgg-primary-dark{
    background-color: rgb(136, 145, 168) !important;
}
.accordion{
    background-color: lightgreen !important;
    border: 1px solid rgb(255, 255, 255) !important;
}
.accordion-dark{
    background-color: rgb(87, 98, 126) !important;
    border: 1px solid rgb(26, 29, 36) !important;
    border-radius: 3px !important;
}
.accordion__item{
    border-radius: 3px !important;
    border: 0 !important;
}
.accordion__item-dark{
    background-color: rgb(75, 100, 131) !important;
}
.accordion__item:last-child{
    height: 100% !important;
}
.accordion__item-dark:last-child{
    overflow: hidden !important;
}
.btn--light{
    background-color: #abafb8 !important;
    border:1px solid #848791 !important
}


@media (max-width: 624px) {

.quiz-a{
    width: 70% !important;
    text-align: center !important;
    margin-left: auto !important;
    margin-right: auto !important;
}

}


</style>

<div data-push data-responsive-width="768px" data-has-scrollable-region data-fullbleed
class="mdk-drawer-layout js-mdk-drawer-layout">
        <div class="mdk-drawer-layout__content" data-perfect-scrollbar>
            <div class="app-messages__container app-messages__container-dark  d-flex flex-column h-100 pb-4">
                <div class="navbar navbar-dark navbar-expand-sm navbar-shadow z-1" id="messages-navbar">
                    <div class="container-fluid flex-wrap px-sm-0">
                        <div class="nav py-2">
                            <div class="nav-item d-flex align-items-center mr-3">
                                <div class="d-flex flex-column" style=" font-size: 21px">
                                    <nav class="nav navbar-nav">
                                        <div class="nav-item navbar-list__item">
                                            {% get_current_language as lang %}
                                            {% if lang == "ar" %}
                                            <a href="{% url 'student courses' %}" class="nav-link h-auto mediabout mediabout-dark">
                                                <i class="material-icons icon--left mediabout mediabout-dark">keyboard_backspace</i> الرجوع إلى لوحة التحكم 
                                            </a>
                                            {% else %}
                                            <a href="{% url 'student courses' %}" class="nav-link h-auto mediabout mediabout-dark">
                                                <i class="material-icons icon--left mediabout mediabout-dark">keyboard_backspace</i> Back to Dashboard
                                            </a>
                                            {% endif %}  
                                        </div>
                                        <div class="nav-item navbar-list__item">
                                            <div class="d-flex align-items-center flex-nowrap">
                                                <div class="mr-16pt">
                                                    <span class="material-icons sidebar-menu-icon sidebar-menu-icon--left mediabout mediabout-dark">dvr</span>
                                                </div>
                                                <div class="flex">
                                                    {% get_current_language as lang %}
                                                    {% if lang == "ar" %}
                                                    <a href="/ar/courses" class="card-title text-body mb-0"><b class="blllu blllu-dark">{{ course.name }}</b></a>
                                                    <p class="lh-1 d-flex align-items-center mb-0">
                                                    </p>
                                                    {% else %}
                                                    <a href="/en/courses" class="card-title text-body mb-0"><b class="blllu blllu-dark">{{ course.name }}</b></a>
                                                    <p class="lh-1 d-flex align-items-center mb-0">
                                                    </p>
                                                    {% endif %}  
                                                </div>
                                            </div>
                                        </div>
                                    </nav>
                                </div>
                            </div>
                        </div>
                        <div class="py-2 flex d-flex align-items-center">
                            <button data-target="#messages-drawer" class="navbar-toggler d-block d-md-none ml-3 p-0"
                                    data-toggle="sidebar" type="button">
                                <i class="material-icons">swipe</i>
                            </button>
                        </div>
                    </div>
                </div>
                {% if end_flag != 1 %}
                <div class="Quiz">
                    <div class="quiz-1">
                        <h2 class="quiz-h2 mediabout mediabout-dark" style="text-align: center;" id="QuizTitle">{{ title }}</h2>
                        {% for content in contents %}
                            {% get_current_language as lang %}
                            {% if lang == "ar" %}
                            <div class="d-flex" style="align-items: center;">
                            <a href="#" class="quiz-a choice_one answeeer answeeer-dark" style="width:95%;text-align: right !important;">{{ content }}</a>
                            <input class="quizAns" style="margin-left:1%; display:none;" type="checkbox" >
                            </div>
                            {% else %}
                            <div class="d-flex" style="align-items: center;">
                            <a href="#" class="quiz-a choice_one answeeer answeeer-dark" style="width:95%;">{{ content }}</a>
                            <input class="quizAns" style="margin-left:1%; display:none;" type="checkbox">
                            </div>
                            {% endif %}
                            <br>
                        {% endfor %}
                    </div>
                </div>
                <div class=" page__container page__container page__container-2 card-footer card-footer-dark" style="width: 100%;height: 70px !important;border-radius: 0 !important;">
                    <div id="message-reply" class="form-down-2">
                        {% get_current_language as lang %}
                        {% if lang == "ar" %}
                        <button class="btn skipp skipp-dark flex" onclick="skipAnswer()" 
                                style="width: 40%;margin:0 auto;margin-top: 30px;">تخطي 
                        </button>
                        {% else %}
                        <button class="btn btn--light btn-dark flex" onclick="skipAnswer()" 
                                style="width: 40%;margin:0 auto;margin-top: 30px;">Skip
                        </button>
                        {% endif %}

                        {% get_current_language as lang %}
                        {% if lang == "ar" %}
                        <button class="btn successbtn successbtn-dark flex" id="checkbtn"
                                style=" width: 40%;margin:0 auto;margin-top: 30px; color: white;"
                                onclick="checkAnswer()">
                            تحقق من الجواب
                        </button>
                        {% else %}
                        <button class="btn successbtn successbtn-dark flex" id="checkbtn"
                                style=" width: 40%;margin:0 auto;margin-top: 30px; color: white;"
                                onclick="checkAnswer()">
                            check answer
                        </button>
                        {% endif %}
                    </div>

                </div>
                {% else %}
                {% get_current_language as lang %}
                {% if lang == "ar" %}
                <div class="Quiz">
                    <div class="quiz-1">
                        <h6 class="quiz-h2 mediabout mediabout-dark" style="text-align: center; font-size: 40px !important;" > &#128079; تهانـينا</h6>
                        <b class="mediabout mediabout-dark" style="font-size: 20px !important;text-align: center !important;" >لقد اجتزت اختبار الشهادة بنجاح, تستطيع تحميل شهادتك بالضغط على " الحصول على شهادتي " بالأعلى</b>
                    </div>
                </div>
                {% else %}
                <div class="Quiz">
                    <div class="quiz-1">
                        <h6 class="quiz-h2" style="text-align: center; font-size: 40px !important;" >Congratlations &#128079;</h6>
                        <h5 class="quiz-h2" style="text-align: center; font-size: 20px !important;" >You have done the quiz and you ready to get your certificate</h5>
                    </div>
                </div>
                {% endif %}
                {% endif %}
            </div>
        </div>

        <style>

            .primary{
                background-color: red !important;
            }
        </style>

        <div class="mdk-drawer js-mdk-drawer" data-align="end" id="messages-drawer">
            <div class="mdk-drawer__content top-0">
                <div class="sidebar sidebar-right sidebar-dark o-hidden">
                    <div class="d-flex flex-column h-100">

                        {% get_current_language as lang %}
                        {% if lang == "ar" %}
                        <div style="margin-top: 10px;" class="flex" data-perfect-scrollbar>
                            <div class="sidebar-heading" style="text-align: right;">قياس الاختبار </div>

                            <ul class="list-group list-group-flush mb-3">
                                <div class="chart chart-2" style="height: 232px; width: 180px;">
                                    <div class="text-center fullbleed d-flex align-items-center justify-content-center flex-column z-0">
                                        <h2 class="m-0 mediabout-dark mediabout">1 / {{ question_count }}</h2>
                                        <strong>{{ left }} متبقي من الاسئلة</strong>
                                    </div>
                                    <canvas class="chart-canvas position-relative z-1" id="attendanceDoughnutChart"
                                            data-chart-legend="#attendanceDoughnutChartLegend"
                                            data-chart-line-background-color="primary;accent;gray.700;gray" width="10" height="10" style="margin-top:25px">
                                        <span style="font-size: 1rem;" class="text-muted"><strong>Attendance</strong> doughnut chart goes here.</span>
                                    </canvas>
                                </div>
                                <div class="col-12">
                                    <div class="nav border-0">
                                    </div>
                                    <div id="attendanceDoughnutChartLegend" class="chart-legend chart-legend--vertical mt-24pt is-fullwidth" style="float: right
                                    text-align:right;">
                                        <sapn class="chart-legend-item">
                                            <i class="fa fa-circle" style="color: rgba(85, 103, 255, 1); margin-right: 5px; font-size:8px">
                                            </i>
                                            <b style="font-size:16px">صيح</b>
                                            <span id="correct_cnt">0</span>
                                        </sapn>
                                        <sapn class="chart-legend-item">
                                            <i class="fa fa-circle" style="color: rgba(242, 240, 124, 1); margin-right: 5px; font-size:8px">
                                            </i>
                                            <b style="font-size:16px">يتخطى</b>
                                            <span id="skip_cnt">0</span>
                                        </sapn>
                                        <sapn class="chart-legend-item">
                                            <i class="fa fa-circle" style="color: rgba(247, 94, 104, 1); margin-right: 5px; font-size:8px">
                                            </i>
                                            <b style="font-size:16px">خاطئ</b>
                                            <span id="wrong_cnt">0</span>
                                        </sapn>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-accentt btn-accentt-dark flex" onclick="continueLater()"
                                        style="width: 90%;margin:0 auto;margin-top: 90px;">أكمل لاحقا
                                </button>
                            </ul>
                        </div>
                        {% else %}
                        <div style="margin-top: 10px;" class="flex" data-perfect-scrollbar>
                            <div class="sidebar-heading">Quiz Timeline</div>

                            <ul class="list-group list-group-flush mb-3">
                                <div class="chart chart-2" style="height: 232px; width: 180px;">
                                    <div class="text-center fullbleed d-flex align-items-center justify-content-center flex-column z-0">
                                        <h2 class="m-0">1 / {{ question_count }}</h2>
                                        <strong>{{ left }} To go</strong>
                                    </div>
                                    <canvas class="chart-canvas position-relative z-1" id="attendanceDoughnutChart"
                                            data-chart-legend="#attendanceDoughnutChartLegend"
                                            data-chart-line-background-color="primary;accent;gray.700;gray" width="10" height="10" style="margin-top:25px">
                                        <span style="font-size: 1rem;" class="text-muted"><strong>Attendance</strong> doughnut chart goes here.</span>
                                    </canvas>
                                </div>
                                <div class="col-6">
                                    <div class="nav border-0">
                                    </div>
                                    <div id="attendanceDoughnutChartLegend" class="chart-legend chart-legend--vertical mt-24pt">
                                        <sapn class="chart-legend-item">
                                            <i class="fa fa-circle" style="color: rgba(85, 103, 255, 1); margin-right: 5px; font-size:8px">
                                            </i>
                                            <b style="font-size:16px">correct:</b>
                                            <span id="correct_cnt">0</span>
                                        </sapn>
                                        <sapn class="chart-legend-item">
                                            <i class="fa fa-circle" style="color: rgba(242, 240, 124, 1); margin-right: 5px; font-size:8px">
                                            </i>
                                            <b style="font-size:16px">skip:</b>
                                            <span id="skip_cnt">0</span>
                                        </sapn>
                                        <sapn class="chart-legend-item">
                                            <i class="fa fa-circle" style="color: rgba(247, 94, 104, 1); margin-right: 5px; font-size:8px">
                                            </i>
                                            <b style="font-size:16px">wrong:</b>
                                            <span id="wrong_cnt">0</span>
                                        </sapn>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-accent flex" onclick="continueLater()"
                                        style="width: 90%;margin:0 auto;margin-top: 90px;">continue later
                                </button>
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="sweet-overlay" tabindex="-1" style="opacity: 1.09; display: none;" id="alert_modal_back"></div>

    <div class="sweet-alert sweet-alert-dark showSweetAlert visible" data-custom-class="" data-has-cancel-button="false"
         id="alert_modal"
         data-has-confirm-button="true" data-allow-outside-click="false" data-has-done-function="true"
         data-animation="pop" data-timer="null" style="display: none; margin-top: -169px;">
        <div class="sa-icon sa-warning pulseWarning" style="display: block;">
          <span class="sa-body pulseWarningIns"></span>
          <span class="sa-dot pulseWarningIns"></span>
        </div>
        <div class="sa-icon sa-success animate" style="display: block;transform: scaleX(-1);">
            <span class="sa-line sa-tip animateSuccessTip"></span>
            <span class="sa-line sa-long animateSuccessLong"></span>
            <div class="sa-placeholder"></div>
            <div class="sa-fix"></div>
        </div>
        <div class="sa-icon sa-custom" style="display: none;"></div>
        <h2 id="alert_title">قيمة خالية</h2>
        <p style="display: block;" id="alert_content">فضلا قم باختيار اجابة من الحقول</p>
        <fieldset>
            <input type="text" tabindex="3" placeholder="">
            <div class="sa-input-error"></div>
        </fieldset>
        <div class="sa-error-container">
            <div class="icon">!</div>
            <p>Not valid!</p>
        </div>
        <div class="sa-button-container">
            <button class="cancel" tabindex="2" style="display: none; box-shadow: none;">Cancel</button>
            <div class="sa-confirm-button-container">
                {% get_current_language as lang %}
                {% if lang == "ar" %}
                <button class="confirm" tabindex="1" onclick="hideAlertModal()"
                        style="display: inline-block; background-color: rgb(33, 150, 243); box-shadow: rgba(33, 150, 243, 0.8) 0px 0px 2px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px inset;">
                    اغلاق
                </button>
                {% else %}
                <button class="confirm" tabindex="1" onclick="hideAlertModal()"
                        style="display: inline-block; background-color: rgb(33, 150, 243); box-shadow: rgba(33, 150, 243, 0.8) 0px 0px 2px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px inset;">
                    OK
                </button>
                {% endif %}
                <div class="la-ball-fall">
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let cache_str = '{{ cache_str }}'
        let question_count = '{{ question_count }}'
        let section_id = "{{ section_id }}"
        let lang = "{{ lang }}"

        let nos = 1
        let quiz_process = []

        // params for doughnut chart
        if (lang == 'ar') {
            var labels = ['إجابات صحيحة', 'تخطي', 'إجابات خاطئة', 'متبقي من الاسئلة']
        } else {
            var labels = ['correct', 'skip', 'wrong', 'left']
        }

        var data = {
            labels: labels,
            datasets: [{
                label: 'My First Dataset',
                data: [0, 0, 0, 100],
                backgroundColor: [
                    "rgb(204, 255, 221)",
                    "rgb(153, 214, 255)",
                    "rgb(255, 102, 102)",
                    "rgb(245, 204, 255)"
                ],
                borderColor: "#FFFFFF",
                borderWidth: 4,
                weight: 1
            }]
        };

        var options = {
            aspectRatio: 1,
            responsive: true,
            cutout: 60,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.label + ":" + context.parsed + "%";;
                        }
                    }
                },
                legend: {
                    display: false
                },
            }
        }

        var chart_config = {
            type: 'doughnut',
            data: data,
            options: options,
        };

        let myChart = null

        $(document).ready(function () {
            $(".quiz-a").click(function(){

                $(".quiz-a").css({ 'background-color' : '', 'color' : '' });
                $(".quizAns").prop( "checked", false );
                $(".quiz-a").removeAttr("id");

                $(this).css("background-color","rgb(127, 201, 250)");
                $(this).css("color","#0F4C75");
                $(this).next().prop( "checked", true );
                $(this).attr("id","thisisselected");
            });

            myChart = new Chart(
                document.getElementById('attendanceDoughnutChart'),
                chart_config
            );

        });

        function hideAlertModal() {
            $("#alert_modal").css({
                'display': 'none'
            })
            $("#alert_modal_back").css({
                'display': 'none'
            })
        }

        function skipAnswer() {
            // fetching next question
            let url = "/check_answer/"
            let data = {
                'section_id': section_id,
                'nos': nos,
                'selected_idx': -1
            }
            $.post(url, data, function(res) {
                // save the process for answering by user into array variable
                quiz_process.push({'status':'skip', 'selected': -1});

                // go to final page when user ends 
                if (res.title == "") {  
                    setInterval(function() {finalize(quiz_process)}, 1000);     
                }

                updateQuestionScreen(res.title, res.contents, quiz_process);
            })
        }

        function checkAnswer() {
            let cnt = 0
            $(".quizAns").each(function() {
                if($(this).is(":checked") == false)
                    cnt++
            })
            //this means student doesnt select anything...
            if(cnt == 4) {
                $(".sa-success").css({
                    'display': 'none'
                })
                $(".sa-warning").css({
                    'display': 'block'
                })
                $("#alert_modal").css({
                    'display': 'block'
                })
                $("#alert_modal_back").css({
                    'display': 'block'
                })

                if (lang == 'ar') {
                    $("#alert_title").html('قيمة خالية')
                    $("#alert_content").html('فضلا قم باختيار اجابة من الحقول ')    
                } else {
                    $("#alert_title").html('No Answer')
                    $("#alert_content").html('Please choose answer.')
                }
                return;
            }

            // getting the index of answer selected by user
            let idx = 0;
            $(".quizAns").each(function() {
                if($(this).is(":checked"))
                    return false;
                idx++;
            })

            // comparing current answer and fetching next question
            let url = "/check_answer/"
            let data = {
                'section_id': section_id,
                'nos': nos,
                'selected_idx': idx
            }
            $.post(url, data, function(res) {
                // save the process for answering by user into array variable
                quiz_process.push({'status':res.status, 'selected': idx})

                // go to final page when user ends 
                if (res.title == "")
                    setInterval(function() {finalize(quiz_process)}, 1000);

                updateQuestionScreen(res.title, res.contents, quiz_process)
            })
        }

        function updateQuestionScreen(title, contents, quiz_process) {
            // updating question html
            $("#QuizTitle").html(title)
            var i = 0;
            $(".quiz-a").each(function() {
                $(this).html(contents[i])
                i++;
            })

            $(".quiz-a").css({ 'background-color' : '', 'color' : '' });
            $(".quizAns").prop( "checked", false );

            // for next question
            nos++

            // updating chart
            correct_cnt = 0;
            skip_cnt = 0;
            wrong_cnt = 0;
            for (let item of quiz_process) {
                switch(item.status) {
                    case 'true':
                        correct_cnt++;
                        break;
                    case 'skip':
                        skip_cnt++;
                        break;
                    case 'false':
                        wrong_cnt++;
                        break;
                }
            }

            $('#correct_cnt').html(correct_cnt)
            $('#skip_cnt').html(skip_cnt)
            $('#wrong_cnt').html(wrong_cnt)

            correct_percent = Math.round(correct_cnt / parseInt(question_count) * 100);
            skip_percent = Math.round(skip_cnt / parseInt(question_count) * 100);
            wrong_percent = Math.round(wrong_cnt / parseInt(question_count) * 100);
            left_percent = 100 - correct_percent - skip_percent - wrong_percent;

            myChart.data.datasets[0].data = [correct_percent, skip_percent, wrong_percent, left_percent]
            myChart.update('active')
        }

        function finalize(quiz_process) {
            var form = document.createElement("form");
            form.method = "POST";
            if (lang == 'ar') 
                form.action = "/ar/quiz/final/";
            else
                form.action = "/en/quiz/final/";

            var element1 = document.createElement("input");
            element1.name = "quiz_process"
            element1.value = JSON.stringify(quiz_process)
            form.appendChild(element1);

            var element2 = document.createElement("input");
            element2.name = "section_id"
            element2.value = section_id
            form.appendChild(element2);

            document.body.appendChild(form);  
            form.submit();
        }

        function continueLater(){
            cache = JSON.parse(cache_str.replace(/&quot;/g, '\"'))
            cache.question_no = parseInt('{{ question_no }}')
            key = '{{ request.user.id }}' + "-" + '{{ course.id }}'

            let url = '/save_cache_str/'
            let str = JSON.stringify(cache)
            let form_data = new FormData()
            form_data.append('cache_str', str)
            form_data.append('key', key)
            $.ajax({
                url: url,
                type: 'POST',
                dataType: 'json',
                async: false,
                contentType: false,
                processData: false,
                data: form_data,
            }).then(response =>{
                location.href = '/courses/'
            })
        }
    </script>
{% endblock %}